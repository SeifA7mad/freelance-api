generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model Account {
  id           String  @id @default(uuid())
  userName     String  @unique
  email        String  @unique
  password     String
  refreshToken String?
  user         User?
}

model User {
  id                         String               @id @default(uuid())
  firstName                  String
  lastName                   String
  bio                        String?
  profilePicture             String?
  timeZone                   DateTime
  createdAt                  DateTime             @default(now())
  updatedAt                  DateTime             @updatedAt
  accountId                  String               @unique
  account                    Account              @relation(fields: [accountId], references: [id], onDelete: Cascade)
  freelancer                 Freelancer?
  client                     Client?
  admin                      Admin?
  senderPaymentTransaction   PaymentTransaction[] @relation("TransactionFromUser")
  receiverPaymentTransaction PaymentTransaction[] @relation("TransactionToUser")
  creditCards                CreditCardInfo[]
  chatMessages               ChatMessage[]

  @@index([accountId])
}

model Freelancer {
  id               String            @id @unique
  jobTitle         String
  jobCategory      JobCategory
  experienceLevel  ExperienceLevel
  user             User              @relation(fields: [id], references: [id], onDelete: Cascade)
  freelancerSkills FreelancerSkill[]
  proposals        Proposal[]
  jobInvitations   JobInvitation[]
  contracts        Contract[]
}

model Client {
  id        String     @id @unique
  user      User       @relation(fields: [id], references: [id], onDelete: Cascade)
  jobs      Job[]
  contracts Contract[]
}

model Admin {
  id         String           @id @unique
  user       User             @relation(fields: [id], references: [id], onDelete: Cascade)
  privileges AdminPrivilege[]
}

model Privilege {
  id         String           @id @default(uuid())
  name       PrivilegeType
  privileges AdminPrivilege[]
}

model AdminPrivilege {
  adminId     String
  privilegeId String
  Admin       Admin     @relation(fields: [adminId], references: [id])
  Privilege   Privilege @relation(fields: [privilegeId], references: [id])

  @@id([adminId, privilegeId])
  @@index([adminId, privilegeId])
}

model Skill {
  id               String            @id @default(uuid())
  name             String
  level            ExperienceLevel
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  freelancerSkills FreelancerSkill[]
  jobSkills        JobSkill[]
}

model FreelancerSkill {
  freelancerId String
  skillId      String
  freelancer   Freelancer @relation(fields: [freelancerId], references: [id], onDelete: Cascade)
  skill        Skill      @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@id([freelancerId, skillId])
  @@index([freelancerId, skillId])
}

model PaymentTransaction {
  id          String                 @id @default(uuid())
  date        DateTime               @default(now())
  description String
  amount      Float
  type        PaymentTransactionType
  senderId    String?
  receiverId  String?
  sender      User?                  @relation("TransactionFromUser", fields: [senderId], references: [id], onDelete: NoAction)
  receiver    User?                  @relation("TransactionToUser", fields: [receiverId], references: [id], onDelete: NoAction)

  @@index([senderId, receiverId])
}

model CreditCardInfo {
  cardNumber     String   @id
  holderName     String
  expiryMonth    DateTime
  expiryYear     DateTime
  billingAddress String
  userId         String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Project {
  id          String      @id @default(uuid())
  title       String
  category    JobCategory
  description String      @db.LongText
  paymentType PaymentType
  type        ProjectType
  price       Float
  length      String
  job         Job?
  contract    Contract?
}

model Job {
  id                     String          @id @default(uuid())
  visability             Visability      @default(PUBLIC)
  location               String
  link                   String
  requiredExperinceLevel ExperienceLevel
  projectId              String          @unique
  clientId               String
  postedAt               DateTime?
  lastViewedAt           DateTime?
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  project                Project         @relation(fields: [projectId], references: [id])
  client                 Client          @relation(fields: [clientId], references: [id], onDelete: Cascade)
  Proposals              Proposal[]
  requiredSkills         JobSkill[]
  jobInvitations         JobInvitation[]
  contract               Contract?

  @@index([clientId, projectId])
}

model ProposalAttachments {
  id         String   @id @default(uuid())
  url        String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  proposalId String
  proposal   Proposal @relation(fields: [proposalId], references: [id], onDelete: Cascade)

  @@index([proposalId])
}

model Proposal {
  id            String                @id @default(uuid())
  bid           Float
  projectLength String
  coverLetter   String                @db.LongText
  freelancerId  String
  jobId         String
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  freelancer    Freelancer            @relation(fields: [freelancerId], references: [id], onDelete: Cascade)
  job           Job                   @relation(fields: [jobId], references: [id], onDelete: Cascade)
  attachments   ProposalAttachments[]

  @@unique([freelancerId, jobId])
  @@index([freelancerId, jobId])
}

model JobSkill {
  jobId   String
  skillId String
  job     Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)
  skill   Skill  @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@id([jobId, skillId])
  @@index([jobId, skillId])
}

model JobInvitation {
  jobId        String
  freelancerId String
  accepted     Boolean    @default(false)
  job          Job        @relation(fields: [jobId], references: [id], onDelete: Cascade)
  freelancer   Freelancer @relation(fields: [freelancerId], references: [id], onDelete: Cascade)

  @@id([jobId, freelancerId])
  @@index([jobId, freelancerId])
}

model ContractAttachments {
  id         String   @id @default(uuid())
  url        String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  contractId String
  contract   Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@index([contractId])
}

model ContractActivities {
  id         String   @id @default(uuid())
  activity   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  contractId String
  contract   Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@index([contractId])
}

model ContractFeedback {
  id         String   @id @default(uuid())
  feedback   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  contractId String
  contract   Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@index([contractId])
}

model Millestone {
  id          String           @id @default(uuid())
  name        String
  amount      Float
  dueDate     DateTime?
  description String?          @db.LongText
  status      MillestoneStatus @default(PENDING)
  contractId  String
  contract    Contract         @relation(fields: [contractId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([contractId])
}

model ChatMessage {
  id         String  @id @default(uuid())
  text       String
  attachment String?

  userId     String
  user       User     @relation(fields: [userId], references: [id])
  contractId String
  contract   Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([contractId, userId])
}

model Contract {
  id              String                @id @default(uuid())
  startDate       DateTime              @default(now())
  endDate         DateTime?
  status          ContractStatus        @default(ACTIVE)
  link            String
  fundedPayment   Float
  receivedPayment Float
  projectId       String                @unique
  jobId           String?               @unique
  freelancerId    String?
  clientId        String
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  project         Project               @relation(fields: [projectId], references: [id])
  job             Job?                  @relation(fields: [jobId], references: [id])
  freelancer      Freelancer?           @relation(fields: [freelancerId], references: [id])
  client          Client                @relation(fields: [clientId], references: [id], onDelete: Cascade)
  attachments     ContractAttachments[]
  activities      ContractActivities[]
  feedbacks       ContractFeedback[]
  millestones     Millestone[]
  chatMessages    ChatMessage[]

  @@index([projectId, jobId, freelancerId, clientId])
}

enum ExperienceLevel {
  EXPERT
  INTERMEDIATE
  Entry_LEVEL
}

enum PaymentTransactionType {
  WITHDRAWAL
  DEPOSIT
  SERVICE_FEE
  FIXED_PRICE
}

enum JobCategory {
  WEB_DEVOLPMENT
}

enum Visability {
  PUBLIC
  PRIVATE
  PROTECTED
}

enum PaymentType {
  FIXED_PRICE
}

enum ProjectType {
  ONE_TIME
  ONGOING
}

enum ContractStatus {
  COMPLETED
  ACTIVE
}

enum MillestoneStatus {
  PENDING
  INPROGRESS
  FULFILLED
  INREVIEW
}

enum PrivilegeType {
  READ
  WRITE
  MANAGE
}
